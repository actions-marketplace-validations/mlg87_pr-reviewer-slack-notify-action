# PR Reviewer Slack Notify Action

This action will post a message to a channel in Slack @ing the requested reviewers when a PR is opened. This is very easy to set up, but will require you to create an app in Slack as well where you can create incoming webhooks for your desired destinations.

## Setting up the Slack app

[Create a Slack App](https://api.slack.com/apps) with `Incoming Webhooks`, `Bots` and `Permissions` functionality. It is worth noting that you will need administrator privileges for this, so hit up your IT team in advance. Once the app is created install it to your workspace. If you are wanting the app to be able to post in private channels, you will need to add the app to the private channel _before_ the private channel will show up as an option when creating the incoming webhooks.

Navigate to `https://api.slack.com/apps/[YOUR_SLACK_APP_ID]/incoming-webhooks` and add a new webhook URL for your workspace. Create a webhook for the channel you would like to post messages in.

## Adding the action to your project

In your `./github/workflows` directory, add a `slackNotify.yml` (or whatever the hell you want to call it) file. Add the following as contents:

```yml
name: PR Review Slack Notify
on:
  pull_request:
    types: [opened, ready_for_review]

jobs:
  notify:
    runs-on: ubuntu-latest
    name: PR Review Slack Notify
    steps:
      - name: Send slack notifications to requested reviewers
        id: pr-slack-notify
        uses: mlg87/pr-reviewer-slack-notify-action@v2.0.0
        with:
          channel-webhook: "[WEBHOOK_URL_GENERATED_FOR_A_CHANNEL]"
          slack-users: '[{ "github_username": "mlg87", "slack_id": "[GET_ME_FROM_YOUR_SLACK_WORKSPACE]" }]'
```

## Action inputs

| Input             | Description                                                                                                    | Required | Type     | Default |
| ----------------- | -------------------------------------------------------------------------------------------------------------- | -------- | -------- | ------- |
| `channel-webhook` | Webhook generated by your Slack app for a specific channel.                                                    | `true`   | `String` | `''`    |
| `slack-users`     | Stringified array of individual users. User shape should match `{ github_username: String, slack_id: String }` | `true`   | `JSON`   | `'[]'`  |

##### NOTE: It is recommended to store the webhook in GitHub Secrets

## How to use

I intended to make this work for the `pull_request.review_requested` event. However, keying off that event will end up spamming your Slack channel you are posting to. This happens because it will include all added reviewers at the time it runs, so if you add `user1` as a reviewer and then search for and add `user2`, it will run the action twice with arrays of `requested_reviewers: [user1, user2]`, and since there is no way to keep track of who has already been notified, this can send _n_ messages.

**Solution**: only run this action on `pull_request.opened` and `pull_request.ready_for_review`. Somewhat annoying that this requires devs to use a specific flow in order for the messages to go out, but it's the best idea I've got right now. Just make sure reviewers are assigned prior to opening the PR or converting a draft to ready. K bye.
